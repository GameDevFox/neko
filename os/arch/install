#!/bin/bash

# Before install:
# * Create partition (use fdisk or cfdisk)
#	ex. fdisk /dev/sda
# * Format partition
#   ex. mkfs.ext4 /dev/sda1
# * Format swap partition
#   ex. mkswap /dev/sda2
# * Mount partitions
#	  ex. mount /dev/sda1 /mnt
#	    mount /dev/vol-group/home /mnt/home
#	    mount /dev/sdb5 /mnt/boot

# After install
# * Install grub
#	ex. vim ./grub-setup
#	    sudo ./grub-setup
# * Setup networking
#	ex. ip link
#	    sudo systemctl enable dhcpcd@interface

read -p "Enter hostname: " hostname

lsblk -f
read -p "Enter swap partition: " swapPart

swapon "$swapPart"

# Make sure we have the latest keyring
pacman -S archlinux-keyring

# Install base
pacstrap /mnt base base-devel
genfstab -p /mnt >> /mnt/etc/fstab
echo "$hostname" >/mnt/etc/hostname

# Link timezone
ln -fs /usr/share/zoneinfo/America/Los_Angeles /etc/localtime

# Generate locale
sed -i '/^#en_US\.UTF-8 UTF-8/ s/#//' /etc/locale.gen
locale-gen
echo LANG=en_US.UTF-8 > /etc/locale.conf

# Make init ram disk
mkinitcpio -p linux

# Copy setup file and execute
wget https://raw.github.com/Prince86EKNJ/royal-neko/master/os/arch/setup -O /mnt/root/setup
chmod +x /mnt/root/setup
arch-chroot /mnt /bin/bash /root/setup

# Clean up setup file
rm /mnt/root/setup

echo "Done!"
